<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KvÃ­z</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/styles/main.css" />
  </head>

  <body id="app">
    <div class="btn-group" role="group" aria-label="Basic example">
      <div class="dropdown">
        <button
          class="btn dropdown-button dropdown-toggle"
          type="button"
          data-bs-toggle="dropdown"
          aria-expanded="false"
        >
          Kontinent
        </button>
        <ul class="dropdown-menu">
          <li>
            <a
              class="dropdown-item"
              role="button"
              data-choice="continent"
              data-continent="world"
              >SvÄ›t</a
            >
          </li>
          <li>
            <a
              class="dropdown-item"
              role="button"
              data-choice="continent"
              data-continent="Europe"
              >Evropa</a
            >
          </li>
          <li>
            <a
              class="dropdown-item"
              role="button"
              data-choice="continent"
              data-continent="Asia"
              >Asie</a
            >
          </li>
          <li>
            <a
              class="dropdown-item"
              role="button"
              data-choice="continent"
              data-continent="Africa"
              >Afrika</a
            >
          </li>
        </ul>
      </div>
      <button type="button" class="btn choice-button" data-choice="capital">
        HlavnÃ­ mÄ›sta
      </button>
      <button type="button" class="btn choice-button" data-choice="currency">
        MÄ›na
      </button>
      <button type="button" class="btn choice-button" data-choice="MPZ">
        MPZ
      </button>
      <button type="button" class="btn choice-button" data-choice="location">
        Lokace
      </button>
      <button type="button" class="btn choice-button" data-choice="religion">
        VyznÃ¡nÃ­
      </button>
      <button type="button" class="btn choice-button" data-choice="stateSystem">
        StÃ¡tnÃ­ systÃ©m
      </button>
    </div>

    <div id="help-window" class="help-window">
      <p id="help-text"></p>

      <button type="button" class="btn" id="close-help">ZavÅ™Ã­t</button>
    </div>

    <form id="myForm" class="container" action="/submit" method="post">
      <div class="horizontal-container">
        <h3>
          SkÃ³re:
          <span id="score"><%= totalScore %></span>
        </h3>
        <h3>
          <span id="continent-display"><%= continent %></span>
        </h3>
        <h3>
          <span id="choice-display"><%= choice %></span>
        </h3>
      </div>

      <h1 id="country-name"><%= question %></h1>

      <div class="answer-container">
        <input
          type="text"
          name="answer"
          id="userInput"
          placeholder="NapiÅ¡ odpovÄ›Ä"
          autofocus
          autocomplete="off"
        />
      </div>

      <button type="submit" class="submit-button">
        POTVRDIT <% if (wasCorrect === true) { %>
        <span class="checkmark">âœ”</span>
        <% } else if (wasCorrect === false) { %>
        <span class="cross" id="error">âœ–</span>
        <% } %>
      </button>
    </form>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <script>
      // NÃ¡povÄ›da
      const helpMessages = {
        currency: `ğ™ğ¤ğ«ğšğ­ğ¤ğš ğ¦ğÌŒğ§ğ²:
        
  âœ¤ 3 znaky`,
        MPZ: `ğŒğğ³ğ¢ğ§ğšÌğ«ğ¨ğğ§ğ¢Ì ğ©ğ¨ğ³ğ§ğšÌğ¯ğšğœğ¢Ì ğ³ğ§ğšğœÌŒğ¤ğ²: 

  âœ¤ 1-3 znaky`,
        location: `âœ¤ UmÃ­stÄ›nÃ­ v rÃ¡mci kontinentu
  âœ¤ 1-2 znaky
  âœ¤ ST (stÅ™ednÃ­)

  ğŒğ¨ğ³ÌŒğ§ğ¨ğ¬ğ­ğ¢: <ul class="location-menu">
  <li id="S">S</li>
  <li id="J">J</li>
  <li id="V">V</li>
  <li id="Z">Z</li>
  <li id="SV">SV</li>
  <li id="SZ">SZ</li>
  <li id="JV">JV</li>
  <li id="JZ">JZ</li>
  <li id="ST">ST</li>
</ul>`,
        religion: `ğğğ£ğ¯ğÌŒğ­ğ¬ÌŒğ¢Ì % ğ¯ğ²ğ³ğ§ğšÌğ§ğ¢Ì: <ul class="religion-menu">
  <li id="anglican">anglikÃ¡nskÃ©</li>
  <li id="animism">animismus</li>
  <li id="apostolic">apoÅ¡tolskÃ©</li>
  <li id="no-faith">bez vÃ­ry</li>
  <li id="buddhism">budhismus</li>
  <li id="evangelical">evangelickÃ©</li>
  <li id="hinduism">hinduismus</li>
  <li id="ibadi-islam">ibÃ¡dÃ­jovskÃ½ islÃ¡m</li>
  <li id="judaism">judaismus</li>
  <li id="lutheran">luterÃ¡nskÃ©</li>
  <li id="orthodoxy">pravoslavÃ­</li>
  <li id="protestants">protestanti</li>
  <li id="roman-catholic">Å™Ã­mskokatolickÃ©</li>
  <li id="roman-catholic-protestants">Å™Ã­mskokatolickÃ©/protestanti</li>
  <li id="sunni-islam">sunnitskÃ½ islÃ¡m</li>
  <li id="syncretic-christians">synkretiÄtÃ­ kÅ™esÅ¥anÃ©</li>
  <li id="shia-islam">Å¡iitskÃ½ islÃ¡m</li>
  <li id="shinto-buddhism">Å¡intoismus/budhismus</li>
</ul>`,
        stateSystem: `ğŒğ¨ğ³ÌŒğ§ğ¨ğ¬ğ­ğ¢: <ul class="stateSystem-menu">
  <li id="absolutni-monarchie">absolutnÃ­ monarchie</li>
  <li id="federativni-demokraticka-republika">federativnÃ­ demokratickÃ¡ republika</li>
  <li id="federativni-konstitucni-monarchie">federativnÃ­ konstituÄnÃ­ monarchie</li>
  <li id="federativni-parlamentni-republika">federativnÃ­ parlamentnÃ­ republika</li>
  <li id="federativni-poloprezidentska-republika">federativnÃ­ poloprezidentskÃ¡ republika</li>
  <li id="federativni-prezidentska-republika">federativnÃ­ prezidentskÃ¡ republika</li>
  <li id="federativni-republika">federativnÃ­ republika</li>
  <li id="islamska-republika">islÃ¡mskÃ¡ republika</li>
  <li id="knizectvi">knÃ­Å¾ectvÃ­</li>
  <li id="konfesionalni-republika">konfesionÃ¡lnÃ­ republika</li>
  <li id="konstitucni-monarchie">konstituÄnÃ­ monarchie</li>
  <li id="lidove-demokraticka-republika">lidovÄ› demokratickÃ¡ republika</li>
  <li id="parlamentni-knizectvi">parlamentnÃ­ knÃ­Å¾ectvÃ­</li>
  <li id="parlamentni-republika">parlamentnÃ­ republika</li>
  <li id="pod-cinskou-spravou">pod ÄŒÃ­nskou sprÃ¡vou</li>
  <li id="poloprezidentska-republika">poloprezidentskÃ¡ republika</li>
  <li id="prezidentska-republika">prezidentskÃ¡ republika</li>
  <li id="prozatimni-vlada">prozatimnÃ­ vlÃ¡da</li>
  <li id="socialisticka-republika">socialistickÃ¡ republika</li>
  <li id="teokraticka-monarchie">teokratickÃ¡ monarchie</li>
  <li id="unitarni-konstitucni-monarchie">unitÃ¡rnÃ­ konstituÄnÃ­ monarchie</li>
  <li id="unitarni-parlamentni-republika">unitÃ¡rnÃ­ parlamentnÃ­ republika</li>
  <li id="unitarni-prezidentska-republika">unitÃ¡rnÃ­ prezidentskÃ¡ republika</li>
</ul>`,
      };

      // Funkce pro vloÅ¾enÃ­ specifickÃ© nÃ¡povÄ›dy do DOM
      function displayHelpMessage(choice) {
        const helpContainer = document.getElementById("help-text");
        helpContainer.innerHTML = helpMessages[choice];
        document.getElementById("help-window").style.display = "block"; // ZobrazenÃ­ nÃ¡povÄ›dy
      }

      // Funkce pro vloÅ¾enÃ­ vybranÃ©ho textu z nÃ¡povÄ›dy do inputu
      function setInputValue(text) {
        const userInput = document.getElementById("userInput");
        userInput.value = text;

        const form = document.getElementById("myForm");
        form.submit(); // OdeslÃ¡nÃ­ formulÃ¡Å™e po vÃ½bÄ›ru

        //userInput.focus(); // NastavÃ­ kurzor do inputu
      }

      // ZvolenÃ¡ nesprÃ¡vnÃ¡ odpovÄ›Ä
      const wasCorrect = "<%= wasCorrect %>";
      console.log(wasCorrect);
      if (wasCorrect === "false") {
        const appElement = document.getElementById("app");
        appElement.innerHTML = `
    <div class="game-over">
      <a href="/" class="restart-button"><span id="restart">Restart</span></a>
      <div class="content-container">
        <h1 class="end-game">Konec hry!</h1>
        <div class="image-container">
          <img src="/images/flower.jpg" alt="Konec hry!" title="Konec hry!" />
          <div class="overlay-score">CelkovÃ© skÃ³re: <%= totalScore %></div>
          <div class="correct-answer"> 
            <% if (typeof answer !== 'undefined') { %>
              <div class="right-answer">SprÃ¡vnÃ¡ odpovÄ›d: <%= answer %></p>
            <% } %> 
          </div>
        </div>
      </div>
    </div>
  `;

        // PÅ™idÃ¡nÃ­ posluchaÄe udÃ¡losti pro klÃ¡vesnici
        document.addEventListener("keydown", function (event) {
          window.location.href = "/";
        });

        // PÅ™idÃ¡nÃ­ posluchaÄe udÃ¡losti pro kliknutÃ­ myÅ¡Ã­
        document.addEventListener("click", function (event) {
          window.location.href = "/";
        });
      }

      let currentChoice = "capital"; // VÃ½chozÃ­ volba typu otÃ¡zky
      let currentContinent = "world"; // VÃ½chozÃ­ kontinent

      // Funkce pro odeslÃ¡nÃ­ volby na server
      async function sendChoiceToServer(choice, continent) {
        console.log("Sending to server - choice:", choice);
        console.log("Sending to server - continent:", continent);

        try {
          const response = await fetch("/select-choice", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ choice, continent }),
          });

          console.log("Response status:", response.status);

          if (response.ok) {
            const data = await response.json();
            console.log("Response from server:", data);

            document.getElementById("choice-display").textContent = data.choice;
            document.getElementById("continent-display").textContent =
              data.continent;
            document.getElementById("country-name").textContent = data.question;
            document.getElementById("score").textContent = data.totalScore;

            // Skryje nÃ¡povÄ›du, pokud je aktuÃ¡lnÃ­ volba "capital"
            const helpWindow = document.getElementById("help-window");
            console.log("Data Choice: " + data.choice);
            if (data.choice === "capital") {
              helpWindow.style.display = "none";
            }
          } else {
            console.error("Failed to update selection");
          }
        } catch (error) {
          console.error("Error during fetch:", error);
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        const helpWindow = document.getElementById("help-window");
        const helpText = document.getElementById("help-text");
        const closeHelpButton = document.getElementById("close-help");

        // ObnovenÃ­ stavu nÃ¡povÄ›dy z localStorage, pokud existuje
        const savedChoice = localStorage.getItem("currentChoice");
        const savedContinent =
          localStorage.getItem("currentContinent") || "world";

        let currentChoice = savedChoice || "capital"; // VÃ½chozÃ­ vÃ½bÄ›r
        let currentContinent = savedContinent; // VÃ½chozÃ­ kontinent

        // Pokud existuje uloÅ¾enÃ¡ volba, zobraz nÃ¡povÄ›du
        if (savedChoice) {
          helpText.innerHTML =
            helpMessages[savedChoice] || "NÃ¡povÄ›da nenÃ­ k dispozici.";
          helpWindow.style.display = "block";
        }

        // SkrytÃ­ nÃ¡povÄ›dy, pokud je aktuÃ¡lnÃ­ volba "capital" po sprÃ¡vnÃ© odpovÄ›di
        if (currentChoice === "capital") {
          helpWindow.style.display = "none";
        }

        // PÅ™idÃ¡nÃ­ posluchaÄe udÃ¡lostÃ­ pro vÃ½bÄ›r z navigaÄnÃ­ho menu
        document.addEventListener("click", function (event) {
          const choice = event.target.getAttribute("data-choice");
          const continent = event.target.getAttribute("data-continent");

          if (choice) {
            // Pokud je kliknuto na nÄ›jakÃ½ kontinent
            if (choice === "continent") {
              currentContinent = continent || "world"; // Aktualizuje aktuÃ¡lnÃ­ volbu
              helpWindow.style.display = "none"; // Skryje nÃ¡povÄ›du
              localStorage.removeItem("currentChoice"); // OdstraÅˆuje uloÅ¾enou volbu
              localStorage.setItem("currentContinent", currentContinent); // UloÅ¾Ã­ aktuÃ¡lnÃ­ volbu
            } else {
              // Pokud je kliknuto na jinÃ½ vÃ½bÄ›r z navigaÄnÃ­ho menu neÅ¾ kontinent
              currentChoice = choice; // Aktualizuje aktuÃ¡lnÃ­ vÃ½bÄ›r
              localStorage.setItem("currentChoice", currentChoice); // UloÅ¾Ã­ aktuÃ¡lnÃ­ vÃ½bÄ›r

              displayHelpMessage(currentChoice); // PouÅ¾itÃ­ specifickÃ© nÃ¡povÄ›dy

              if (currentChoice === "capital") {
                helpWindow.style.display = "none"; // Skryje nÃ¡povÄ›du pro "capital"
              } else {
                helpText.innerHTML =
                  helpMessages[choice] || "NÃ¡povÄ›da nenÃ­ k dispozici.";
                helpWindow.style.display = "block"; // ZobrazÃ­ nÃ¡povÄ›du
              }
            }

            console.log("Updated - currentChoice:", currentChoice);
            console.log("Updated - currentContinent:", currentContinent);

            sendChoiceToServer(currentChoice, currentContinent);
          }
        });

        // PosluchaÄ pro specifickou nÃ¡povÄ›du a vloÅ¾enÃ­ hodnoty do inputu
        document.body.addEventListener("click", function (event) {
          // Kontroluje, zda kliknutÃ½ prvek odpovÃ­dÃ¡ nÄ›kterÃ©mu z uvedenÃ½ch selektorÅ¯
          if (
            event.target.matches(
              ".religion-menu li, .stateSystem-menu li, .location-menu li"
            )
          ) {
            const text = event.target.textContent; // ZÃ­skÃ¡nÃ­ textovÃ©ho obsahu
            setInputValue(text); // NastavenÃ­ hodnoty inputu na zÃ­skanÃ½ text
          }
        });

        // PosluchaÄ pro zavÅ™enÃ­ okna s nÃ¡povÄ›dou
        closeHelpButton.addEventListener("click", function () {
          console.log("Closing help window");
          helpWindow.style.display = "none"; // Skryje nÃ¡povÄ›du
          localStorage.removeItem("currentChoice"); // OdstranÃ­ uloÅ¾enou volbu
        });
      });
    </script>
  </body>
</html>
